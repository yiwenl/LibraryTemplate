!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).WebGLAnimation=e()}(this,(function(){"use strict";var t={exports:{}};!function(t){var e=Object.prototype.hasOwnProperty,r="~";function i(){}function n(t,e,r){this.fn=t,this.context=e,this.once=r||!1}function s(t,e,i,s,o){if("function"!=typeof i)throw new TypeError("The listener must be a function");var a=new n(i,s||t,o),_=r?r+e:e;return t._events[_]?t._events[_].fn?t._events[_]=[t._events[_],a]:t._events[_].push(a):(t._events[_]=a,t._eventsCount++),t}function o(t,e){0==--t._eventsCount?t._events=new i:delete t._events[e]}function a(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(r=!1)),a.prototype.eventNames=function(){var t,i,n=[];if(0===this._eventsCount)return n;for(i in t=this._events)e.call(t,i)&&n.push(r?i.slice(1):i);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},a.prototype.listeners=function(t){var e=r?r+t:t,i=this._events[e];if(!i)return[];if(i.fn)return[i.fn];for(var n=0,s=i.length,o=new Array(s);n<s;n++)o[n]=i[n].fn;return o},a.prototype.listenerCount=function(t){var e=r?r+t:t,i=this._events[e];return i?i.fn?1:i.length:0},a.prototype.emit=function(t,e,i,n,s,o){var a=r?r+t:t;if(!this._events[a])return!1;var _,E,h=this._events[a],u=arguments.length;if(h.fn){switch(h.once&&this.removeListener(t,h.fn,void 0,!0),u){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,e),!0;case 3:return h.fn.call(h.context,e,i),!0;case 4:return h.fn.call(h.context,e,i,n),!0;case 5:return h.fn.call(h.context,e,i,n,s),!0;case 6:return h.fn.call(h.context,e,i,n,s,o),!0}for(E=1,_=new Array(u-1);E<u;E++)_[E-1]=arguments[E];h.fn.apply(h.context,_)}else{var T,c=h.length;for(E=0;E<c;E++)switch(h[E].once&&this.removeListener(t,h[E].fn,void 0,!0),u){case 1:h[E].fn.call(h[E].context);break;case 2:h[E].fn.call(h[E].context,e);break;case 3:h[E].fn.call(h[E].context,e,i);break;case 4:h[E].fn.call(h[E].context,e,i,n);break;default:if(!_)for(T=1,_=new Array(u-1);T<u;T++)_[T-1]=arguments[T];h[E].fn.apply(h[E].context,_)}}return!0},a.prototype.on=function(t,e,r){return s(this,t,e,r,!1)},a.prototype.once=function(t,e,r){return s(this,t,e,r,!0)},a.prototype.removeListener=function(t,e,i,n){var s=r?r+t:t;if(!this._events[s])return this;if(!e)return o(this,s),this;var a=this._events[s];if(a.fn)a.fn!==e||n&&!a.once||i&&a.context!==i||o(this,s);else{for(var _=0,E=[],h=a.length;_<h;_++)(a[_].fn!==e||n&&!a[_].once||i&&a[_].context!==i)&&E.push(a[_]);E.length?this._events[s]=1===E.length?E[0]:E:o(this,s)}return this},a.prototype.removeAllListeners=function(t){var e;return t?(e=r?r+t:t,this._events[e]&&o(this,e)):(this._events=new i,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=r,a.EventEmitter=a,t.exports=a}(t);var e=t.exports,r=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable;
/*
  object-assign
  (c) Sindre Sorhus
  @license MIT
  */var s=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},r=0;r<10;r++)e["_"+String.fromCharCode(r)]=r;var i=Object.getOwnPropertyNames(e).map((function(t){return e[t]}));if("0123456789"!==i.join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach((function(t){n[t]=t})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(t){return!1}}()?Object.assign:function(t,e){for(var s,o,a=function(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}(t),_=1;_<arguments.length;_++){for(var E in s=Object(arguments[_]))i.call(s,E)&&(a[E]=s[E]);if(r){o=r(s);for(var h=0;h<o.length;h++)n.call(s,o[h])&&(a[o[h]]=s[o[h]])}}return a},o=1e-6,a="undefined"!=typeof Float32Array?Float32Array:Array;function _(t,e){return Math.abs(t-e)<=o*Math.max(1,Math.abs(t),Math.abs(e))}function E(){var t=new a(9);return a!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function h(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function u(t,e){if(t===e){var r=e[1],i=e[2],n=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=i,t[7]=n}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function T(t,e){var r=e[0],i=e[1],n=e[2],s=e[3],o=e[4],a=e[5],_=e[6],E=e[7],h=e[8],u=h*o-a*E,T=-h*s+a*_,c=E*s-o*_,l=r*u+i*T+n*c;return l?(l=1/l,t[0]=u*l,t[1]=(-h*i+n*E)*l,t[2]=(a*i-n*o)*l,t[3]=T*l,t[4]=(h*r-n*_)*l,t[5]=(-a*r+n*s)*l,t[6]=c*l,t[7]=(-E*r+i*_)*l,t[8]=(o*r-i*s)*l,t):null}function c(){var t=new a(16);return a!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function l(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function f(t,e){var r=e[0],i=e[1],n=e[2],s=e[3],o=e[4],a=e[5],_=e[6],E=e[7],h=e[8],u=e[9],T=e[10],c=e[11],l=e[12],f=e[13],R=e[14],A=e[15],d=r*a-i*o,p=r*_-n*o,L=r*E-s*o,m=i*_-n*a,N=i*E-s*a,I=n*E-s*_,S=h*f-u*l,v=h*R-T*l,g=h*A-c*l,C=u*R-T*f,O=u*A-c*f,U=T*A-c*R,M=d*U-p*O+L*C+m*g-N*v+I*S;return M?(M=1/M,t[0]=(a*U-_*O+E*C)*M,t[1]=(n*O-i*U-s*C)*M,t[2]=(f*I-R*N+A*m)*M,t[3]=(T*N-u*I-c*m)*M,t[4]=(_*g-o*U-E*v)*M,t[5]=(r*U-n*g+s*v)*M,t[6]=(R*L-l*I-A*p)*M,t[7]=(h*I-T*L+c*p)*M,t[8]=(o*O-a*g+E*S)*M,t[9]=(i*g-r*O-s*S)*M,t[10]=(l*N-f*L+A*d)*M,t[11]=(u*L-h*N-c*d)*M,t[12]=(a*v-o*C-_*S)*M,t[13]=(r*C-i*v+n*S)*M,t[14]=(f*p-l*m-R*d)*M,t[15]=(h*m-u*p+T*d)*M,t):null}function R(t,e,r){var i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],_=e[5],E=e[6],h=e[7],u=e[8],T=e[9],c=e[10],l=e[11],f=e[12],R=e[13],A=e[14],d=e[15],p=r[0],L=r[1],m=r[2],N=r[3];return t[0]=p*i+L*a+m*u+N*f,t[1]=p*n+L*_+m*T+N*R,t[2]=p*s+L*E+m*c+N*A,t[3]=p*o+L*h+m*l+N*d,p=r[4],L=r[5],m=r[6],N=r[7],t[4]=p*i+L*a+m*u+N*f,t[5]=p*n+L*_+m*T+N*R,t[6]=p*s+L*E+m*c+N*A,t[7]=p*o+L*h+m*l+N*d,p=r[8],L=r[9],m=r[10],N=r[11],t[8]=p*i+L*a+m*u+N*f,t[9]=p*n+L*_+m*T+N*R,t[10]=p*s+L*E+m*c+N*A,t[11]=p*o+L*h+m*l+N*d,p=r[12],L=r[13],m=r[14],N=r[15],t[12]=p*i+L*a+m*u+N*f,t[13]=p*n+L*_+m*T+N*R,t[14]=p*s+L*E+m*c+N*A,t[15]=p*o+L*h+m*l+N*d,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var A=function(t,e,r,i,n){var s,o=1/Math.tan(e/2);return t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=n&&n!==1/0?(s=1/(i-n),t[10]=(n+i)*s,t[14]=2*n*i*s):(t[10]=-1,t[14]=-2*i),t};function d(){var t=new a(3);return a!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function p(t,e,r){var i=new a(3);return i[0]=t,i[1]=e,i[2]=r,i}function L(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function m(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function N(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function I(t,e){var r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return r*r+i*i+n*n}function S(t,e){var r=e[0],i=e[1],n=e[2],s=r*r+i*i+n*n;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t}function v(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function g(t,e,r){var i=e[0],n=e[1],s=e[2],o=r[0],a=r[1],_=r[2];return t[0]=n*_-s*a,t[1]=s*o-i*_,t[2]=i*a-n*o,t}var C=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t};function O(){var t=new a(4);return a!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}d(),function(){var t,e=(t=new a(4),a!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t)}();d(),p(1,0,0),p(0,1,0),O(),O(),E(),function(){var t,e=(t=new a(2),a!=Float32Array&&(t[0]=0,t[1]=0),t)}();function U(t,e){const r=t.getExtension(e);if(!r)return!1;const i=e.split("_")[0],n=new RegExp(`${i}$`);for(const e in r){if("function"==typeof r[e]){const i=e.replace(n,"");e.substring&&(t[i]=r[e].bind(r))}}return!0}const M=["EXT_shader_texture_lod","EXT_sRGB","EXT_frag_depth","OES_texture_float","OES_texture_half_float","OES_texture_float_linear","OES_texture_half_float_linear","OES_standard_derivatives","OES_element_index_uint","EXT_texture_filter_anisotropic","EXT_color_buffer_half_float","OES_vertex_array_object","WEBGL_depth_texture","ANGLE_instanced_arrays","WEBGL_color_buffer_float","WEBGL_draw_buffers","EXT_color_buffer_float"],F=(()=>{let t=!1;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(t=!0),t})(),P=(t,e)=>{if("number"==typeof t)return _(t,e);if(t.length!==e.length)return!1;let r=!0;return t.forEach(((t,i)=>{r=_(t,e[i])&&r})),r},b={ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALPHA:6406,ALPHA_BITS:3413,ALWAYS:519,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATTACHED_SHADERS:35717,BACK:1029,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BROWSER_DEFAULT_WEBGL:37444,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_BUFFER_BIT:16384,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,COMPILE_STATUS:35713,COMPRESSED_TEXTURE_FORMATS:34467,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_LOST_WEBGL:37442,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH_ATTACHMENT:36096,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,RED:6403,DEPTH_COMPONENT16:33189,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DONT_CARE:4352,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,FASTEST:4353,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GREATER:516,GREEN_BITS:3411,HALF_FLOAT:36193,HIGH_FLOAT:36338,HIGH_INT:36341,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INT:5124,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE_ALPHA:6410,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_RENDERBUFFER_SIZE:34024,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIRRORED_REPEAT:33648,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NUM_COMPRESSED_TEXTURE_FORMATS:34466,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,RED_BITS:3410,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,REPEAT:10497,REPLACE:7681,RGB:6407,RGB5_A1:32855,RGB565:36194,RGBA:6408,RGBA4:32854,SAMPLER_2D:35678,SAMPLER_CUBE:35680,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SHADER_COMPILER:36346,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_CLEAR_VALUE:2961,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE2:33986,TEXTURE3:33987,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE30:34014,TEXTURE31:34015,TEXTURE_2D:3553,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,UNPACK_ALIGNMENT:3317,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VIEWPORT:2978,ZERO:0,R8:33321},B={0:"NONE",1:"ONE",2:"LINE_LOOP",3:"LINE_STRIP",4:"TRIANGLES",5:"TRIANGLE_STRIP",6:"TRIANGLE_FAN",256:"DEPTH_BUFFER_BIT",512:"NEVER",513:"LESS",514:"EQUAL",515:"LEQUAL",516:"GREATER",517:"NOTEQUAL",518:"GEQUAL",519:"ALWAYS",768:"SRC_COLOR",769:"ONE_MINUS_SRC_COLOR",770:"SRC_ALPHA",771:"ONE_MINUS_SRC_ALPHA",772:"DST_ALPHA",773:"ONE_MINUS_DST_ALPHA",774:"DST_COLOR",775:"ONE_MINUS_DST_COLOR",776:"SRC_ALPHA_SATURATE",1024:"STENCIL_BUFFER_BIT",1028:"FRONT",1029:"BACK",1032:"FRONT_AND_BACK",1280:"INVALID_ENUM",1281:"INVALID_VALUE",1282:"INVALID_OPERATION",1285:"OUT_OF_MEMORY",1286:"INVALID_FRAMEBUFFER_OPERATION",2304:"CW",2305:"CCW",2849:"LINE_WIDTH",2884:"CULL_FACE",2885:"CULL_FACE_MODE",2886:"FRONT_FACE",2928:"DEPTH_RANGE",2929:"DEPTH_TEST",2930:"DEPTH_WRITEMASK",2931:"DEPTH_CLEAR_VALUE",2932:"DEPTH_FUNC",2960:"STENCIL_TEST",2961:"STENCIL_CLEAR_VALUE",2962:"STENCIL_FUNC",2963:"STENCIL_VALUE_MASK",2964:"STENCIL_FAIL",2965:"STENCIL_PASS_DEPTH_FAIL",2966:"STENCIL_PASS_DEPTH_PASS",2967:"STENCIL_REF",2968:"STENCIL_WRITEMASK",2978:"VIEWPORT",3024:"DITHER",3042:"BLEND",3088:"SCISSOR_BOX",3089:"SCISSOR_TEST",3106:"COLOR_CLEAR_VALUE",3107:"COLOR_WRITEMASK",3317:"UNPACK_ALIGNMENT",3333:"PACK_ALIGNMENT",3379:"MAX_TEXTURE_SIZE",3386:"MAX_VIEWPORT_DIMS",3408:"SUBPIXEL_BITS",3410:"RED_BITS",3411:"GREEN_BITS",3412:"BLUE_BITS",3413:"ALPHA_BITS",3414:"DEPTH_BITS",3415:"STENCIL_BITS",3553:"TEXTURE_2D",4352:"DONT_CARE",4353:"FASTEST",4354:"NICEST",5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5124:"INT",5125:"UNSIGNED_INT",5126:"FLOAT",5386:"INVERT",5890:"TEXTURE",6401:"STENCIL_INDEX",6402:"DEPTH_COMPONENT",6403:"RED",6406:"ALPHA",6407:"RGB",6408:"RGBA",6409:"LUMINANCE",6410:"LUMINANCE_ALPHA",7680:"KEEP",7681:"REPLACE",7682:"INCR",7683:"DECR",7936:"VENDOR",7937:"RENDERER",7938:"VERSION",9728:"NEAREST",9729:"LINEAR",9984:"NEAREST_MIPMAP_NEAREST",9985:"LINEAR_MIPMAP_NEAREST",9986:"NEAREST_MIPMAP_LINEAR",9987:"LINEAR_MIPMAP_LINEAR",10240:"TEXTURE_MAG_FILTER",10241:"TEXTURE_MIN_FILTER",10242:"TEXTURE_WRAP_S",10243:"TEXTURE_WRAP_T",10497:"REPEAT",10752:"POLYGON_OFFSET_UNITS",16384:"COLOR_BUFFER_BIT",32769:"CONSTANT_COLOR",32770:"ONE_MINUS_CONSTANT_COLOR",32771:"CONSTANT_ALPHA",32772:"ONE_MINUS_CONSTANT_ALPHA",32773:"BLEND_COLOR",32774:"FUNC_ADD",32777:"BLEND_EQUATION_RGB",32778:"FUNC_SUBTRACT",32779:"FUNC_REVERSE_SUBTRACT",32819:"UNSIGNED_SHORT_4_4_4_4",32820:"UNSIGNED_SHORT_5_5_5_1",32823:"POLYGON_OFFSET_FILL",32824:"POLYGON_OFFSET_FACTOR",32854:"RGBA4",32855:"RGB5_A1",32873:"TEXTURE_BINDING_2D",32926:"SAMPLE_ALPHA_TO_COVERAGE",32928:"SAMPLE_COVERAGE",32936:"SAMPLE_BUFFERS",32937:"SAMPLES",32938:"SAMPLE_COVERAGE_VALUE",32939:"SAMPLE_COVERAGE_INVERT",32968:"BLEND_DST_RGB",32969:"BLEND_SRC_RGB",32970:"BLEND_DST_ALPHA",32971:"BLEND_SRC_ALPHA",33071:"CLAMP_TO_EDGE",33170:"GENERATE_MIPMAP_HINT",33189:"DEPTH_COMPONENT16",33306:"DEPTH_STENCIL_ATTACHMENT",33321:"R8",33635:"UNSIGNED_SHORT_5_6_5",33648:"MIRRORED_REPEAT",33901:"ALIASED_POINT_SIZE_RANGE",33902:"ALIASED_LINE_WIDTH_RANGE",33984:"TEXTURE0",33985:"TEXTURE1",33986:"TEXTURE2",33987:"TEXTURE3",33988:"TEXTURE4",33989:"TEXTURE5",33990:"TEXTURE6",33991:"TEXTURE7",33992:"TEXTURE8",33993:"TEXTURE9",33994:"TEXTURE10",33995:"TEXTURE11",33996:"TEXTURE12",33997:"TEXTURE13",33998:"TEXTURE14",33999:"TEXTURE15",34e3:"TEXTURE16",34001:"TEXTURE17",34002:"TEXTURE18",34003:"TEXTURE19",34004:"TEXTURE20",34005:"TEXTURE21",34006:"TEXTURE22",34007:"TEXTURE23",34008:"TEXTURE24",34009:"TEXTURE25",34010:"TEXTURE26",34011:"TEXTURE27",34012:"TEXTURE28",34013:"TEXTURE29",34014:"TEXTURE30",34015:"TEXTURE31",34016:"ACTIVE_TEXTURE",34024:"MAX_RENDERBUFFER_SIZE",34041:"DEPTH_STENCIL",34055:"INCR_WRAP",34056:"DECR_WRAP",34067:"TEXTURE_CUBE_MAP",34068:"TEXTURE_BINDING_CUBE_MAP",34069:"TEXTURE_CUBE_MAP_POSITIVE_X",34070:"TEXTURE_CUBE_MAP_NEGATIVE_X",34071:"TEXTURE_CUBE_MAP_POSITIVE_Y",34072:"TEXTURE_CUBE_MAP_NEGATIVE_Y",34073:"TEXTURE_CUBE_MAP_POSITIVE_Z",34074:"TEXTURE_CUBE_MAP_NEGATIVE_Z",34076:"MAX_CUBE_MAP_TEXTURE_SIZE",34338:"VERTEX_ATTRIB_ARRAY_ENABLED",34339:"VERTEX_ATTRIB_ARRAY_SIZE",34340:"VERTEX_ATTRIB_ARRAY_STRIDE",34341:"VERTEX_ATTRIB_ARRAY_TYPE",34342:"CURRENT_VERTEX_ATTRIB",34373:"VERTEX_ATTRIB_ARRAY_POINTER",34466:"NUM_COMPRESSED_TEXTURE_FORMATS",34467:"COMPRESSED_TEXTURE_FORMATS",34660:"BUFFER_SIZE",34661:"BUFFER_USAGE",34816:"STENCIL_BACK_FUNC",34817:"STENCIL_BACK_FAIL",34818:"STENCIL_BACK_PASS_DEPTH_FAIL",34819:"STENCIL_BACK_PASS_DEPTH_PASS",34877:"BLEND_EQUATION_ALPHA",34921:"MAX_VERTEX_ATTRIBS",34922:"VERTEX_ATTRIB_ARRAY_NORMALIZED",34930:"MAX_TEXTURE_IMAGE_UNITS",34962:"ARRAY_BUFFER",34963:"ELEMENT_ARRAY_BUFFER",34964:"ARRAY_BUFFER_BINDING",34965:"ELEMENT_ARRAY_BUFFER_BINDING",34975:"VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",35040:"STREAM_DRAW",35044:"STATIC_DRAW",35048:"DYNAMIC_DRAW",35632:"FRAGMENT_SHADER",35633:"VERTEX_SHADER",35660:"MAX_VERTEX_TEXTURE_IMAGE_UNITS",35661:"MAX_COMBINED_TEXTURE_IMAGE_UNITS",35663:"SHADER_TYPE",35664:"FLOAT_VEC2",35665:"FLOAT_VEC3",35666:"FLOAT_VEC4",35667:"INT_VEC2",35668:"INT_VEC3",35669:"INT_VEC4",35670:"BOOL",35671:"BOOL_VEC2",35672:"BOOL_VEC3",35673:"BOOL_VEC4",35674:"FLOAT_MAT2",35675:"FLOAT_MAT3",35676:"FLOAT_MAT4",35678:"SAMPLER_2D",35680:"SAMPLER_CUBE",35712:"DELETE_STATUS",35713:"COMPILE_STATUS",35714:"LINK_STATUS",35715:"VALIDATE_STATUS",35716:"INFO_LOG_LENGTH",35717:"ATTACHED_SHADERS",35718:"ACTIVE_UNIFORMS",35719:"ACTIVE_UNIFORM_MAX_LENGTH",35720:"SHADER_SOURCE_LENGTH",35721:"ACTIVE_ATTRIBUTES",35722:"ACTIVE_ATTRIBUTE_MAX_LENGTH",35724:"SHADING_LANGUAGE_VERSION",35725:"CURRENT_PROGRAM",36003:"STENCIL_BACK_REF",36004:"STENCIL_BACK_VALUE_MASK",36005:"STENCIL_BACK_WRITEMASK",36006:"FRAMEBUFFER_BINDING",36007:"RENDERBUFFER_BINDING",36048:"FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",36049:"FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",36050:"FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",36051:"FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",36053:"FRAMEBUFFER_COMPLETE",36054:"FRAMEBUFFER_INCOMPLETE_ATTACHMENT",36055:"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",36057:"FRAMEBUFFER_INCOMPLETE_DIMENSIONS",36061:"FRAMEBUFFER_UNSUPPORTED",36064:"COLOR_ATTACHMENT0",36096:"DEPTH_ATTACHMENT",36128:"STENCIL_ATTACHMENT",36160:"FRAMEBUFFER",36161:"RENDERBUFFER",36162:"RENDERBUFFER_WIDTH",36163:"RENDERBUFFER_HEIGHT",36164:"RENDERBUFFER_INTERNAL_FORMAT",36168:"STENCIL_INDEX8",36176:"RENDERBUFFER_RED_SIZE",36177:"RENDERBUFFER_GREEN_SIZE",36178:"RENDERBUFFER_BLUE_SIZE",36179:"RENDERBUFFER_ALPHA_SIZE",36180:"RENDERBUFFER_DEPTH_SIZE",36181:"RENDERBUFFER_STENCIL_SIZE",36193:"HALF_FLOAT",36194:"RGB565",36336:"LOW_FLOAT",36337:"MEDIUM_FLOAT",36338:"HIGH_FLOAT",36339:"LOW_INT",36340:"MEDIUM_INT",36341:"HIGH_INT",36346:"SHADER_COMPILER",36347:"MAX_VERTEX_UNIFORM_VECTORS",36348:"MAX_VARYING_VECTORS",36349:"MAX_FRAGMENT_UNIFORM_VECTORS",37440:"UNPACK_FLIP_Y_WEBGL",37441:"UNPACK_PREMULTIPLY_ALPHA_WEBGL",37442:"CONTEXT_LOST_WEBGL",37443:"UNPACK_COLORSPACE_CONVERSION_WEBGL",37444:"BROWSER_DEFAULT_WEBGL"};var D={alpha:!1,depth:!0,premultipliedAlpha:!1};let x=0;function y(){let t,e,r=[0,0,0,0],i=0,n=0,o=0,a=(()=>{const t=document.createElement("canvas");return!(!t.getContext("experimental-webgl2")&&!t.getContext("webgl2"))})(),_=F;const A=c(),d=c(),p=c(),L=E(),m=c(),N=E();this.id="WebGLContext"+x++,this.canvas,this.gl,this.CONTEXT_LOST="contextLost",this.CONTEXT_RESTORED="contextRestored",this.shaderCount=0,this.bufferCount=0,this.textureCount=0,this.frameBufferCount=0,this.maxAnisotropy=0,this.multiRenderTargetSupport=!1,this.maxMultiRenderTargets=0,this.init=function(t,e={}){const r=s({},D,e);if(void 0!==t){if(t instanceof HTMLCanvasElement){this.canvas=t;let i=a?"webgl2":"webgl";e.webgl1&&(i="webgl",a=!1),this.gl=t.getContext(i,r)}else window.WebGL2RenderingContext&&t instanceof WebGL2RenderingContext?(a=!0,this.gl=t,this.canvas=t.canvas):t instanceof WebGLRenderingContext?(a=!1,this.gl=t,this.canvas=t.canvas):console.error("The source has to be one of the following : Canvas, WebGLRenderingContext or WebGL2RenderingContext");this.canvas.addEventListener("webglcontextlost",S),this.canvas.addEventListener("webglcontextrestored",v),this.extensions=(t=>{const{gl:e}=t,r=window.WebGL2RenderingContext&&e instanceof WebGL2RenderingContext,i={};M.forEach((t=>{i[t]=e.getExtension(t)})),r||(i.OES_vertex_array_object||console.error("OES_vertex_array_object extension is not supported"),U(e,"OES_vertex_array_object"),U(e,"ANGLE_instanced_arrays"),U(e,"WEBGL_draw_buffers"));const n=i.EXT_texture_filter_anisotropic;if(n&&(t.maxAnisotropy=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),t.multiRenderTargetSupport=!!t.gl.drawBuffers,t.multiRenderTargetSupport){const r=t.gl.MAX_DRAW_BUFFERS||i.WEBGL_draw_buffers.MAX_DRAW_BUFFERS_WEBGL;t.maxMultiRenderTargets=e.getParameter(r)}return i})(this),(t=>{for(const e in b)t[e]?console.log("already exist : ",e):t[e]=b[e];if(t.webgl2){const e=/^[^a-z]*$/;for(const r in t.gl)e.test(r)&&-1===r.indexOf("FLOAT")&&(t[r]=t.gl[r],b[r]=t.gl[r],B[t[r]]=r)}})(this),this.setSize(this.canvas.width,this.canvas.height),this.enable(this.BLEND),this.enableAlphaBlending(),this.enable(this.DEPTH_TEST),this.enable(this.CULL_FACE),this.cullFace(w.BACK)}else{const t=document.createElement("canvas");this.init(t,r)}},this.clear=function(t=0,e=0,r=0,i=0){const{gl:n}=this;n.clearColor(t,e,r,i),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT)},this.setSize=function(t,e){n=Math.floor(t),o=Math.floor(e),this.canvas.width=n,this.canvas.height=o,i=n/o,this.viewport(0,0,n,o)},this.viewport=function(t,e,i,n){P(r,[t,e,i,n])||(r=[t,e,i,n],this.gl.viewport(t,e,i,n))},this.getViewport=function(){return r},this.getAspectRatio=function(){return i},this.enable=function(t){this.gl.enable(t)},this.disable=function(t){this.gl.disable(t)},this.cullFace=function(t){this.gl.cullFace(t)},this.enableAlphaBlending=function(){const{gl:t}=this;t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA)},this.enableAdditiveBlending=function(){const{gl:t}=this;t.blendFunc(t.ONE,t.ONE)},this.setMatrices=function(t){e=t,this.setModelMatrix(d)},this.setModelMatrix=function(t){l(p,t),void 0!==e&&(R(A,e.viewMatrix,p),h(L,A),T(L,L),u(L,L),h(N,A),T(N,N),f(m,e.viewMatrix))},this.useShader=function(e){t=e,this.shaderProgram=e.shaderProgram,this.gl.useProgram(this.shaderProgram)},this.draw=function(e){if(e.length)return void e.forEach((t=>this.draw(t)));I(),t.updateUniforms(),e.bind(this);const{drawType:r}=e,{gl:i}=this;e.isInstanced?i.drawElementsInstanced(e.drawType,e.numItems,i.UNSIGNED_INT,0,e.numInstance):r===i.POINTS?i.drawArrays(r,0,e.vertexSize):i.drawElements(r,e.numItems,i.UNSIGNED_INT,0),e.unbind()},this.getCamera=function(){return e},this.destroy=function(t=!0){this.gl.getExtension("WEBGL_lose_context").loseContext(),t&&void 0!==this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas)},this.__defineGetter__("width",(function(){return n})),this.__defineGetter__("height",(function(){return o})),this.__defineGetter__("webgl2",(function(){return a})),this.__defineGetter__("isMobile",(function(){return _})),this.__defineGetter__("aspectRatio",(function(){return i}));const I=()=>{void 0!==e&&(t.uniform("uProjectionMatrix","mat4",e.projectionMatrix),t.uniform("uViewMatrix","mat4",e.viewMatrix),t.uniform("uNormalMatrix","mat3",L),t.uniform("uModelViewMatrixInverse","mat3",N)),t.uniform("uModelMatrix","mat4",p)},S=()=>{this.emit(this.CONTEXT_LOST)},v=()=>{this.emit(this.CONTEXT_RESTORED)}}y.prototype=Object.assign(Object.create(e.prototype),{constructor:y});const w=new y,X={float:"uniform1f",vec2:"uniform2fv",vec3:"uniform3fv",vec4:"uniform4fv",int:"uniform1i",ivec2:"uniform2i",ivec3:"uniform3i",ivec4:"uniform4i",mat2:"uniformMatrix2fv",mat3:"uniformMatrix3fv",mat4:"uniformMatrix4fv"},G=t=>"number"==typeof t?t:t.slice?t.slice(0):new Float32Array(t),V=t=>"object"==typeof t?function(t){return 9===t.length?"mat3":16===t.length?"mat4":`vec${t.length}`}(t):"float";function H(t,e){let r;this.vertexShader=t||"precision highp float;\n#define GLSLIFY 1\nattribute vec3 aVertexPosition;attribute vec2 aTextureCoord;attribute vec3 aNormal;uniform mat4 uModelMatrix;uniform mat4 uViewMatrix;uniform mat4 uProjectionMatrix;varying vec2 vTextureCoord;varying vec3 vNormal;void main(void){gl_Position=uProjectionMatrix*uViewMatrix*uModelMatrix*vec4(aVertexPosition,1.0);vTextureCoord=aTextureCoord;vNormal=aNormal;}",this.fragmentShader=e||"precision highp float;\n#define GLSLIFY 1\nvoid main(void){gl_FragColor=vec4(1.0);}",this.shaderProgram;let i={};this.bind=function(t){if(void 0===t||void 0===r||t===r){if(r=t||w,!this.shaderProgram){const t=n(this.vertexShader,!0),e=n(this.fragmentShader,!1);s(t,e)}r.useShader(this)}else console.error("this shader has been bind to a different WebGL Rendering Context",r.id)},this.uniform=function(t,e,r){let n,s;void 0===r?(s=V(e),n=e):(s=e,n=r);const o=X[s];if(i[t]){const e=i[t];P(e.value,n)||(e.value=G(n),e.changed=!0)}else i[t]={type:s,uniformType:o,value:G(n),changed:!0};return this},this.updateUniforms=function(){if(!r)return void console.warn("No WebGL Context has been set yet, please call shader.bind() first");const{gl:t}=r;for(let e in i){const r=i[e];if(r.changed){const i=e;r.uniformLoc||(r.uniformLoc=t.getUniformLocation(this.shaderProgram,i));const{uniformLoc:n,uniformType:s,value:o}=r;null!==n&&(-1===s.indexOf("Matrix")?t[s](n,o):t[s](n,!1,o)),r.changed=!1}}},this.destroy=function(){const{gl:t}=r;t.deleteProgram(this.shaderProgram),r.shaderCount--};const n=(t,e)=>{const{gl:i}=r,n=e?r.VERTEX_SHADER:r.FRAGMENT_SHADER,s=i.createShader(n);return i.shaderSource(s,t),i.compileShader(s),i.getShaderParameter(s,i.COMPILE_STATUS)?s:(console.warn("Error in Shader : ",i.getShaderInfoLog(s)),console.log((t=>{const e=t.split("\n");for(let t=0;t<e.length;t++)e[t]=`${t+1}: ${e[t]}`;return e.join("\n")})(t)),null)},s=(t,e)=>{const{gl:i}=r;this.shaderProgram=i.createProgram(),i.attachShader(this.shaderProgram,t),i.attachShader(this.shaderProgram,e),i.deleteShader(t),i.deleteShader(e),i.linkProgram(this.shaderProgram),r.shaderCount++}}function W(t=b.TRIANGLES){this.drawType=t,this.numItems=0;let e,r,i,n,s,o=[],a=[],_=[],E=!0,h=!1,u=0;this.bufferData=function(t,e,r,i=b.STATIC_DRAW,n=!1){let s,o=[];if("number"==typeof t[0]){if(s=t,void 0===r)return console.error("Missing element size for flatten data :",e),this;for(let t=0;t<s.length;t+=r){const e=[];for(let i=0;i<r;i++)e.push(s[t+i]);o.push(e)}}else o=t,s=(t=>{if(t[0]instanceof Float32Array){const e=t.reduce(((t,e)=>{for(let r=0;r<e.length;r++)t.push(e[r]);return t}),[]);return e}return t.flat()})(t);const a=void 0===r?t[0].length:r;return T(s,t,e,a,i,n)},this.bufferInstance=function(t,e){const r=t[0].length;return u=t.length,this.bufferData(t,e,r,b.STATIC_DRAW,!0)},this.bufferVertex=function(t,e=b.STATIC_DRAW){return this.bufferData(t,"aVertexPosition",3,e)},this.bufferTexCoord=function(t,e=b.STATIC_DRAW){return this.bufferData(t,"aTextureCoord",2,e)},this.bufferNormal=function(t,e=b.STATIC_DRAW){return this.bufferData(t,"aNormal",3,e)},this.bufferIndex=function(t,e=b.STATIC_DRAW){return r=e,i=new Uint32Array(t),this.numItems=i.length,E=!0,this},this.bind=function(t){if(void 0!==t&&void 0!==s&&t!==s)return void console.error("this mesh has been bind to a different WebGL Rendering Context");s=t||GL;const{gl:r}=s;c(),r.bindVertexArray(e),this.vertexSize=this.getSource("aVertexPosition").length},this.unbind=function(){},this.getAttribute=function(t){return o.find((e=>e.name===t))},this.getAttributes=function(){return o},this.getSource=function(t){const e=this.getAttribute(t);return e?e.source:[]},this.generateFaces=function(){let t,e,r,n,s,o;_=[];const{vertices:a}=this;for(let E=0;E<i.length;E+=3){t=i[E],e=i[E+1],r=i[E+2],n=a[t],s=a[e],o=a[r];const h={indices:[t,e,r],vertices:[n,s,o]};_.push(h)}},this.destroy=function(){const{gl:t}=s;o.forEach((e=>{t.deleteBuffer(e.buffer),e.source=[],e.dataArray=[],s.bufferCount--})),n&&(t.deleteBuffer(n),s.bufferCount--),t.deleteVertexArray(e),o=[],i=[],a=[]},this.__defineGetter__("vertices",(function(){return this.getSource("aVertexPosition")})),this.__defineGetter__("coords",(function(){return this.getSource("aTextureCoord")})),this.__defineGetter__("normal",(function(){return this.getSource("aNormal")})),this.__defineGetter__("indices",(function(){return i})),this.__defineGetter__("faces",(function(){return _})),this.__defineGetter__("isInstanced",(function(){return h})),this.__defineGetter__("numInstance",(function(){return u}));const T=(t,e,r,i,n=b.STATIC_DRAW,s=!1)=>{const _=n;h=s||h;const E=new Float32Array(t),u=this.getAttribute(r);return u?(u.itemSize=i,u.dataArray=E,u.source=e):o.push({name:r,source:e,itemSize:i,usage:_,dataArray:E,isInstanced:s}),a.push(r),this},c=()=>{const{shaderProgram:t,gl:r}=s;0!=a.length&&(e||(e=r.createVertexArray()),r.bindVertexArray(e),o.forEach((e=>{if(-1!==a.indexOf(e.name)){const i=function(t,e){let r;const{gl:i}=e;return void 0!==t.buffer?r=t.buffer:(r=i.createBuffer(),t.buffer=r,e.bufferCount++),r}(e,s);r.bindBuffer(r.ARRAY_BUFFER,i),r.bufferData(r.ARRAY_BUFFER,e.dataArray,e.usage);const n=((t,e,r)=>(void 0===e.cacheAttribLoc&&(e.cacheAttribLoc={}),void 0===e.cacheAttribLoc[r]&&(e.cacheAttribLoc[r]=t.getAttribLocation(e,r)),e.cacheAttribLoc[r]))(r,t,e.name);n>=0&&(r.enableVertexAttribArray(n),r.vertexAttribPointer(n,e.itemSize,r.FLOAT,!1,0,0)),e.attrPosition=n,e.isInstanced&&r.vertexAttribDivisor(n,1)}})),l(),r.bindVertexArray(null),E=!1,a=[])},l=()=>{const{gl:t}=s;E&&(n||(n=t.createBuffer(),s.bufferCount++),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n),t.bufferData(t.ELEMENT_ARRAY_BUFFER,i,r))}}const j=t=>0!==t&&!(t&t-1);class Y{constructor(t){this._value=t}set(t,e=1){this._value=this._value,this._value=0===e?this._value&0<<t:this._value|1<<t}get(t){let e=this._value&1<<t;return e>>=t,1===e}reset(t){this._value=t}get value(){return this._value}}const k={DRAW_BUFFERS:"This browser doesn't support multi render targets : WEBGL_draw_buffers",FRAMEBUFFER_CONTEXT:"This framebuffer has been bind to a different WebGL Rendering Context",SHADER_CONTEXT:"This shader has been bind to a different WebGL Rendering Context",TEXTURE_CONTEXT:"This texture has been bind to a different WebGL Rendering Context",CUBE_TEXTURE_CONTEXT:"This cube texture has been bind to a different WebGL Rendering Context"},K=(t,e="")=>{console.error(t,e)};class Z{constructor(t,e={},r=0,i=0){this._source=t,this._isHtmlElement=(t=>t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement)(this._source),(this._isHtmlElement||!t||((t,e)=>{let r=!0;return"Array"===t.constructor.name&&(console.error("Please convert texture source to Unit8Array or Float32Array"),r=!1),void 0===e.type&&"Uint8Array"!==t.constructor.name&&console.error("Using none Unit8Array, pleaes specify type in the texture parameters"),r})(t,e))&&(this._getDimension(t,r,i),this._params=function(t,e,r){if(!t.minFilter){let i=b.LINEAR;e&&e&&j(e)&&j(r)&&(i=b.NEAREST_MIPMAP_LINEAR),t.minFilter=i}return t.mipmap=void 0===t.mipmap||t.mipmap,t.magFilter=t.magFilter||b.LINEAR,t.wrapS=t.wrapS||b.CLAMP_TO_EDGE,t.wrapT=t.wrapT||b.CLAMP_TO_EDGE,t.internalFormat=t.internalFormat||b.RGBA,t.format=t.format||b.RGBA,t.premultiplyAlpha=void 0!==t.premultiplyAlpha&&t.premultiplyAlpha,t.level=t.level||0,t.type=t.type||b.UNSIGNED_BYTE,t}(e,this._width,this._height),this._checkMipmap(),this._parametersState=new Y(0))}bind(t,e){if(void 0!==e&&void 0!==this.GL&&e!==this.GL)return void K(k.TEXTURE_CONTEXT,this.GL.id);this.GL=e||w;const{gl:r}=this.GL;this.createTexture(this.GL),r.activeTexture(r.TEXTURE0+t),r.bindTexture(r.TEXTURE_2D,this._texture),this._checkParameters()}createTexture(t){void 0===t||void 0===this.GL||t===this.GL?(this.GL=t||w,this._texture||(((t,e)=>{t.webgl2&&(e.type===b.HALF_FLOAT?(e.type=t.gl.HALF_FLOAT,e.internalFormat=b.RGBA16F):e.type===b.FLOAT&&(e.internalFormat=b.RGBA32F))})(this.GL,this._params),this._uploadTexture())):K(k.TEXTURE_CONTEXT,this.GL.id)}updateTexture(t){this._source=t,this._uploadTexture()}generateMipmap(){if(!this._generateMipmap)return;const{gl:t}=this.GL;t.bindTexture(t.TEXTURE_2D,this._texture),t.generateMipmap(t.TEXTURE_2D)}destroy(){const{gl:t}=this.GL;t.deleteTexture(this._texture),this.GL.textureCount--}showProperties(){console.log("Dimension :",this._width,this._height);for(const t in this._params)console.log(t,B[this._params[t]]||this._params[t])}_uploadTexture(){const{gl:t}=this.GL;this._texture||(this._texture=t.createTexture(),this.GL.textureCount++),t.bindTexture(t.TEXTURE_2D,this._texture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),this._isHtmlElement&&!this.GL.webgl2?t.texImage2D(t.TEXTURE_2D,0,this._params.internalFormat,this._params.format,this._params.type,this._source):t.texImage2D(t.TEXTURE_2D,0,this._params.internalFormat,this._width,this._height,0,this._params.format,this._params.type,this._source),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,this._params.magFilter),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,this._params.minFilter),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,this._params.wrapS),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,this._params.wrapT),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this._premultiplyAlpha),this._generateMipmap&&t.generateMipmap(t.TEXTURE_2D)}_checkParameters(){const{gl:t}=this.GL;this._parametersState.value>0&&(this._parametersState.get(0)?t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,this._params.minFilter):this._parametersState.get(1)?t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,this._params.magFilter):this._parametersState.get(2)?t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,this._params.wrapS):t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,this._params.wrapT)),this._parametersState.reset(0)}_getDimension(t,e,r){t?(this._width=t.width||t.videoWidth,this._height=t.height||t.videoWidth,this._width=this._width||e,this._height=this._height||r,this._width&&this._height||(this._width=this._height=Math.sqrt(t.length/4))):(this._width=e,this._height=r)}_checkMipmap(){this._generateMipmap=this._params.mipmap,j(this._width)&&j(this._height)||(this._generateMipmap=!1);-1===B[this._params.minFilter].indexOf("MIPMAP")&&(this._generateMipmap=!1)}get texture(){return this._texture}set minFilter(t){this._params.minFilter=t,this._parametersState.set(0,1)}get minFilter(){return this._params.minFilter}set magFilter(t){this._params.magFilter=t,this._parametersState.set(1,1)}get magFilter(){return this._params.magFilter}set wrapS(t){this._params.wrapS=t,this._parametersState.set(2,1)}get wrapS(){return this._params.wrapS}set wrapT(t){this._params.wrapT=t,this._parametersState.set(3,1)}get wrapT(){return this._params.wrapT}get width(){return this._width}get height(){return this._height}}class z{constructor(){this._mtxView=c(),this._mtxProj=c(),this._near=0,this._far=0,this._lookDir=d()}lookAt(t,e,r=[0,1,0]){!function(t,e,r,i){var n,s,a,_,E,h,u,T,c,l,f=e[0],R=e[1],A=e[2],d=i[0],p=i[1],L=i[2],m=r[0],N=r[1],I=r[2];Math.abs(f-m)<o&&Math.abs(R-N)<o&&Math.abs(A-I)<o?function(t){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(t):(u=f-m,T=R-N,c=A-I,n=p*(c*=l=1/Math.hypot(u,T,c))-L*(T*=l),s=L*(u*=l)-d*c,a=d*T-p*u,(l=Math.hypot(n,s,a))?(n*=l=1/l,s*=l,a*=l):(n=0,s=0,a=0),_=T*a-c*s,E=c*n-u*a,h=u*s-T*n,(l=Math.hypot(_,E,h))?(_*=l=1/l,E*=l,h*=l):(_=0,E=0,h=0),t[0]=n,t[1]=_,t[2]=u,t[3]=0,t[4]=s,t[5]=E,t[6]=T,t[7]=0,t[8]=a,t[9]=h,t[10]=c,t[11]=0,t[12]=-(n*f+s*R+a*A),t[13]=-(_*f+E*R+h*A),t[14]=-(u*f+T*R+c*A),t[15]=1)}(this._mtxView,t,e,r)}setFromViewProjection(t,e){l(this._mtxView,t),l(this._mtxProj,e)}setViewMatrix(t){l(this._mtxView,t)}setProjectionMatrix(t){l(this._mtxProj,t)}_updateMatrices(){}get viewMatrix(){return this._mtxView}get view(){return this._mtxView}get projectionMatrix(){return this._mtxProj}get projection(){return this._mtxProj}get position(){const t=c();return f(t,this._mtxView),[t[12],t[13],t[14]]}get direction(){const t=E();return h(t,this._mtxView),u(t,t),function(t,e,r){var i=e[0],n=e[1],s=e[2];t[0]=i*r[0]+n*r[3]+s*r[6],t[1]=i*r[1]+n*r[4]+s*r[7],t[2]=i*r[2]+n*r[5]+s*r[8]}(this._lookDir,[0,0,-1],t),S(this._lookDir,this._lookDir),this._lookDir}set near(t){this._near=t,this._updateMatrices()}get near(){return this._near}set far(t){this._far=t,this._updateMatrices()}get far(){return this._far}}function Q(t,e){this.origin=t,this.direction=e;const r=d(),i=d(),n=d(),s=d(),o=d(),_=d(),E=d(),h=d();this.at=function(t){return L(s,this.direction),N(s,s,t),m(s,s,this.origin),s},this.lookAt=function(t){C(this.direction,t,this.origin),S(this.origin,this.origin)},this.closestPointToPoint=function(t){const e=d();C(t,this.origin);const r=v(e,this.direction);return r<0?function(t){var e=new a(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}(this.origin):(L(e,this.direction),N(e,e,r),m(e,e,this.origin),e)},this.distanceToPoint=function(t){return Math.sqrt(this.distanceSqToPoint(t))},this.distanceSqToPoint=function(t){const e=d();C(e,t,this.origin);const r=v(e,this.direction);return r<0?I(this.origin,t):(L(e,this.direction),N(e,e,r),m(e,e,this.origin),I(e,t))},this.intersectsSphere=function(t,e){return this.distanceToPoint(t)<=e},this.intersectSphere=function(t,e){const r=d();C(r,t,this.origin);const i=v(r,this.direction),n=v(r,r)-i*i,s=e*e;if(n>s)return null;const o=Math.sqrt(s-n),a=i-o,_=i+o;return a<0&&_<0?null:a<0?this.at(_):this.at(a)},this.intersectTriangle=function(t,e,s,a=!0){L(r,t),L(i,e),L(n,s),C(o,i,r),C(_,n,r),g(E,o,_);let u,T=v(this.direction,E);if(T>0){if(a)return null;u=1}else{if(!(T<0))return null;u=-1,T=-T}C(h,this.origin,r),g(_,h,_);const c=u*v(this.direction,_);if(c<0)return null;g(o,o,h);const l=u*v(this.direction,o);if(l<0)return null;if(c+l>T)return null;const f=-u*v(h,E);return f<0?null:this.at(f/T)}}class q extends z{constructor(t,e,r,i){super(),this._fov=0,this._ratio=0,this.setPerspective(t,e,r,i)}setPerspective(t,e,r,i){A(this._mtxProj,t,e,r,i),this._near=r,this._far=i,this._fov=t,this._ratio=e}setAspectRatio(t){this._ratio=t,this._updateMatrices()}generateRay(t,e){const r=c(),i=d();return R(r,this._mtxProj,this._mtxView),f(r,r),function(t,e,r){var i=e[0],n=e[1],s=e[2],o=r[3]*i+r[7]*n+r[11]*s+r[15];o=o||1,t[0]=(r[0]*i+r[4]*n+r[8]*s+r[12])/o,t[1]=(r[1]*i+r[5]*n+r[9]*s+r[13])/o,t[2]=(r[2]*i+r[6]*n+r[10]*s+r[14])/o}(i,t,r),C(i,i,this.position),S(i,i),e?(e.origin=this.position,e.direction=i):e=new Q(this.position,i),e}_updateMatrices(){this.setPerspective(this._fov,this._ratio,this._near,this._far)}}class ${constructor(t){return this._GL=t||w,this._uniforms={},this._uniformTextures=[],this._fbo,this._clearColor={r:0,g:0,b:0,a:0},this}setClearColor(t=0,e=0,r=0,i=0){return this._clearColor.r=t,this._clearColor.g=e,this._clearColor.b=r,this._clearColor.a=i,this}useProgram(t,e){return this._shader=t instanceof H?t:new H(t,e),this}setMesh(t){return this._mesh=t,this}createMesh(t){return this._mesh=new W(t),this}bufferVertex(t){return this._mesh||(this._mesh=new W),this._mesh.bufferVertex(t),this}bufferTexCoord(t){return this._mesh||(this._mesh=new W),this._mesh.bufferTexCoord(t),this}bufferNormal(t){return this._mesh||(this._mesh=new W),this._mesh.bufferNormal(t),this}bufferIndex(t){return this._mesh||(this._mesh=new W),this._mesh.bufferIndex(t),this}bufferInstance(t,e){return this._mesh?(this._mesh.bufferInstance(t,e),this):(console.warn("Need to create mesh first"),this)}bufferData(t,e){return this._mesh||(this._mesh=new W),this._mesh.bufferData(t,e),this}uniform(t,e,r){const i=t;let n,s;return void 0===r?(s=V(e),n=e):(s=e,n=r),this._uniforms[i]={type:s,value:n},this}uniformTexture(t,e,r){return this.bindTexture(t,e,r)}bindTexture(t,e,r){return void 0!==r?this._uniformTextures[r]={name:t,texture:e}:this._uniformTextures.push({name:t,texture:e}),this}bindFrameBuffer(t){return this._fbo=t,this}draw(){if(this._shader){if(this._mesh){if(this._fbo){const{r:t,g:e,b:r,a:i}=this._clearColor;this._fbo.bind(this._GL),this._GL.clear(t,e,r,i)}this._shader.bind(this._GL);for(const t in this._uniforms){const e=this._uniforms[t];this._shader.uniform(t,e.type,e.value)}return this._uniformTextures.forEach(((t,e)=>{void 0!==t&&(this._shader.uniform(t.name,"int",e),t.texture.bind(e,this._GL))})),this._GL.draw(this._mesh),this._fbo&&this._fbo.unbind(),this}console.warn("No Mesh assigned for draw call")}else console.warn("No GLShader assigned for draw call")}get shader(){return this._shader}get framebuffer(){return this._fbo}}class J extends ${constructor(t){super(t);const e=this._GL,r=1e3,i=[[-r,0,0],[r,0,0],[0,-r,0],[0,r,0],[0,0,-r],[0,0,r]];this.createMesh(e.LINES).bufferVertex(i).bufferData([[1,0,0],[1,0,0],[0,1,0],[0,1,0],[0,0,1],[0,0,1]],"aColor").bufferIndex([0,1,2,3,4,5]).useProgram("precision highp float;\n#define GLSLIFY 1\nattribute vec3 aVertexPosition;attribute vec3 aColor;uniform mat4 uModelMatrix;uniform mat4 uViewMatrix;uniform mat4 uProjectionMatrix;varying vec3 vColor;void main(void){gl_Position=uProjectionMatrix*uViewMatrix*uModelMatrix*vec4(aVertexPosition,1.0);vColor=aColor;}","precision highp float;\n#define GLSLIFY 1\nvarying vec3 vColor;uniform float uOpacity;void main(void){gl_FragColor=vec4(vColor,uOpacity);}"),this.opacity=.75}draw(){this.uniform("uOpacity",this.opacity),super.draw()}}class tt extends ${constructor(t){super(t);const e=this._GL,r=[],i=[];let n=0;const s=100;let o,a;for(o=-100;o<s;o+=1)for(a=-100;a<s;a+=1)r.push([o,a,0]),i.push(n),n++,r.push([o,0,a]),i.push(n),n++;this.createMesh(e.POINTS).bufferVertex(r).bufferIndex(i).useProgram("#define SHADER_NAME DOTS_PLANE_VERTEX\nprecision highp float;\n#define GLSLIFY 1\nattribute vec3 aVertexPosition;uniform mat4 uModelMatrix;uniform mat4 uViewMatrix;uniform mat4 uProjectionMatrix;uniform vec2 uViewport;uniform float uScale;uniform float uPointScale;const float radius=0.008;void main(void){gl_Position=uProjectionMatrix*uViewMatrix*uModelMatrix*vec4(aVertexPosition*uScale,1.0);float distOffset=uViewport.y*uProjectionMatrix[1][1]*radius/gl_Position.w;gl_PointSize=distOffset*uPointScale;}","precision highp float;\n#define GLSLIFY 1\nuniform vec3 uColor;uniform float uOpacity;void main(void){gl_FragColor=vec4(uColor,uOpacity);}"),this.color=[1,1,1],this.opacity=.5,this.pointScale=1,this.scale=1}draw(){const{width:t,height:e}=this._GL;this.uniform("uColor",this.color).uniform("uOpacity",this.opacity).uniform("uScale",this.scale).uniform("uPointScale",this.pointScale).uniform("uViewport",[t,e]),super.draw()}}let et=window,rt=60,it=performance.now(),nt=0,st=0,ot=it;const at=[],_t=[],Et=[],ht=[];let ut=[],Tt=[],ct=-1,lt=0;function ft(){!function(){let t,e=0,r=1e3/rt,i=0;for(e=0;e<at.length;e++)t=at[e],null!=t&&t.func(t.args);for(;ut.length>0;)t=ut.pop(),t.func(t.args);let n=performance.now();for(st=(n-it)/1e3,nt=n-ot,e=0;e<_t.length;e++)t=_t[e],n-t.time>t.delay&&(t.func(t.args),_t.splice(e,1));for(n=performance.now();Et.length>0;){if(t=Et.shift(),i=performance.now(),!(i-n<r)){Et.unshift(t);break}t.func(t.args)}for(n=performance.now();ht.length>0;)t=ht.shift(),i=performance.now(),i-n<r&&t.func(t.args);ot=n,ut=ut.concat(Tt),Tt=[]}(),ct=et.requestAnimationFrame(ft)}ft();var Rt=function(t,e){const r=++lt;return at[r]={func:t,args:e},r},At=function(t){return void 0!==at[t]&&(at[t]=null),-1};class dt{constructor(t,e=.1){this.easing=e,this._value=t,this._targetValue=t,this._efIndex=Rt((()=>this._update()))}_update(){this._checkLimit(),this._value+=(this._targetValue-this._value)*this.easing,Math.abs(this._targetValue-this._value)<1e-4&&(this._value=this._targetValue)}setTo(t){this._targetValue=this._value=t}add(t){this._targetValue+=t}limit(t,e){t>e?this.limit(e,t):(this._min=t,this._max=e,this._checkLimit())}_checkLimit(){void 0!==this._min&&this._targetValue<this._min&&(this._targetValue=this._min),void 0!==this._max&&this._targetValue>this._max&&(this._targetValue=this._max)}destroy(){At(this._efIndex)}set value(t){this._targetValue=t}get value(){return this._value}get targetValue(){return this._targetValue}}const pt=function(t,e){const r=e||{};return t.touches?(r.x=t.touches[0].pageX,r.y=t.touches[0].pageY):(r.x=t.clientX,r.y=t.clientY),r};class Lt{constructor(t,e=window,r=10){this._target=t,this._listenerTarget=e,this._mouse={},this._preMouse={},this.center=d(),this._up=p(0,1,0),this.radius=new dt(r),this.position=p(0,0,this.radius.value),this.positionOffset=d(),this._rx=new dt(0),this._rx.limit(-Math.PI/2,Math.PI/2),this._ry=new dt(0),this._preRX=0,this._preRY=0,this._isLockZoom=!1,this._isLockRotation=!1,this._isInvert=!1,this.sensitivity=1,this._wheelBind=t=>this._onWheel(t),this._downBind=t=>this._onDown(t),this._moveBind=t=>this._onMove(t),this._upBind=()=>this._onUp(),this.connect(),Rt((()=>this._loop()))}connect(){this.disconnect(),this._listenerTarget.addEventListener("mousewheel",this._wheelBind),this._listenerTarget.addEventListener("DOMMouseScroll",this._wheelBind),this._listenerTarget.addEventListener("mousedown",this._downBind),this._listenerTarget.addEventListener("touchstart",this._downBind),this._listenerTarget.addEventListener("mousemove",this._moveBind),this._listenerTarget.addEventListener("touchmove",this._moveBind),window.addEventListener("touchend",this._upBind),window.addEventListener("mouseup",this._upBind)}disconnect(){this._listenerTarget.removeEventListener("mousewheel",this._wheelBind),this._listenerTarget.removeEventListener("DOMMouseScroll",this._wheelBind),this._listenerTarget.removeEventListener("mousedown",this._downBind),this._listenerTarget.removeEventListener("touchstart",this._downBind),this._listenerTarget.removeEventListener("mousemove",this._moveBind),this._listenerTarget.removeEventListener("touchmove",this._moveBind),window.removeEventListener("touchend",this._upBind),window.removeEventListener("mouseup",this._upBind)}lock(t=!0){this._isLockZoom=t,this._isLockRotation=t,this._isMouseDown=!1}lockZoom(t=!0){this._isLockZoom=t}lockRotation(t=!0){this._isLockRotation=t}inverseControl(t=!0){this._isInvert=t}_onDown(t){this._isLockRotation||(this._isMouseDown=!0,pt(t,this._mouse),pt(t,this._preMouse),this._preRX=this._rx.targetValue,this._preRY=this._ry.targetValue)}_onMove(t){if(!this._isLockRotation&&(pt(t,this._mouse),t.touches&&t.preventDefault(),this._isMouseDown)){let t=-(this._mouse.x-this._preMouse.x);this._isInvert&&(t*=-1),this._ry.value=this._preRY-.01*t*this.sensitivity;let e=-(this._mouse.y-this._preMouse.y);this._isInvert&&(e*=-1),this._rx.value=this._preRX-.01*e*this.sensitivity}}_onUp(){this._isLockRotation||(this._isMouseDown=!1)}_onWheel(t){if(this._isLockZoom)return;const e=t.wheelDelta,r=t.detail;let i=0;i=r?e?e/r/40*r>0?1:-1:-r/3:e/120,this.radius.add(2*-i),this.radius.targetValue<0&&(this.radius.value=1e-4)}_loop(){this._updatePosition(),this._target&&this._updateCamera()}update(){this._updatePosition()}_updatePosition(){this.position[1]=Math.sin(this._rx.value)*this.radius.value;const t=Math.cos(this._rx.value)*this.radius.value;this.position[0]=Math.cos(this._ry.value+.5*Math.PI)*t,this.position[2]=Math.sin(this._ry.value+.5*Math.PI)*t,m(this.position,this.position,this.positionOffset)}_updateCamera(){this._target.lookAt(this.position,this.center,this._up)}get rx(){return this._rx}get ry(){return this._ry}}const mt=t=>{const e=t.normals.length>0,r=t.coords.length>0;let i;if(t.positions.length>65535){const n=[];let s=0;const o={};for(o.positions=t.positions.concat(),o.coords=t.coords.concat(),o.indices=t.indices.concat(),o.normals=t.normals.concat();t.indices.length>0;){const a=Math.min(65535,t.positions.length),_=t.indices.splice(0,a),E=[],h=[],u=[];let T,c=0;for(let t=0;t<_.length;t++)_[t]>c&&(c=_[t]),T=_[t],E.push(o.positions[T]),r&&h.push(o.coords[T]),e&&u.push(o.normals[T]),_[t]-=s;s=c+1,i=new W,i.bufferVertex(E),r&&i.bufferTexCoord(h),i.bufferIndex(_),e&&i.bufferNormal(u),n.push(i)}return n}return i=new W,i.bufferVertex(t.positions),r&&i.bufferTexCoord(t.coords),i.bufferIndex(t.indices),e&&i.bufferNormal(t.normals),i};Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function t(){var e=isNaN(arguments[0])?1:Number(arguments[0]);return e?Array.prototype.reduce.call(this,(function(r,i){return Array.isArray(i)?r.push.apply(r,t.call(i,e-1)):r.push(i),r}),[]):Array.prototype.slice.call(this)},writable:!0});const Nt=[];let It;const St=t=>{It=t.map((({id:t,file:e,type:r})=>{const i=e;let n;switch(r){case"jpg":case"png":n=new Z(e);break;case"text":n=(t=>{const e=t.split("\n"),r=[],i=[],n=[],s=[],o=[],a=[],_=[];let E,h=0;const u=/v( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,T=/vn( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,c=/vt( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,l=/f( +-?\d+)( +-?\d+)( +-?\d+)( +-?\d+)?/,f=/f( +(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+))?/,R=/f( +(-?\d+)\/(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+)\/(-?\d+))?/,A=/f( +(-?\d+)\/\/(-?\d+))( +(-?\d+)\/\/(-?\d+))( +(-?\d+)\/\/(-?\d+))( +(-?\d+)\/\/(-?\d+))?/;function d(t){const e=parseInt(t);return 3*(e>=0?e-1:e+s.length/3)}function p(t){const e=parseInt(t);return 3*(e>=0?e-1:e+o.length/3)}function L(t){const e=parseInt(t);return 2*(e>=0?e-1:e+a.length/2)}function m(t,e,i){r.push([s[t],s[t+1],s[t+2]]),r.push([s[e],s[e+1],s[e+2]]),r.push([s[i],s[i+1],s[i+2]]),_.push(3*h+0),_.push(3*h+1),_.push(3*h+2),h++}function N(t,e,r){i.push([a[t],a[t+1]]),i.push([a[e],a[e+1]]),i.push([a[r],a[r+1]])}function I(t,e,r){n.push([o[t],o[t+1],o[t+2]]),n.push([o[e],o[e+1],o[e+2]]),n.push([o[r],o[r+1],o[r+2]])}function S(t,e,r,i,n,s,o,a,_,E,h,u){let T,c=d(t),l=d(e),f=d(r);void 0===i?m(c,l,f):(T=d(i),m(c,l,T),m(l,f,T)),void 0!==n&&(c=L(n),l=L(s),f=L(o),void 0===i?N(c,l,f):(T=L(a),N(c,l,T),N(l,f,T))),void 0!==_&&(c=p(_),l=p(E),f=p(h),void 0===i?I(c,l,f):(T=p(u),I(c,l,T),I(l,f,T)))}for(let t=0;t<e.length;t++){let r=e[t];r=r.trim(),0!==r.length&&"#"!==r.charAt(0)&&(null!==(E=u.exec(r))?s.push(parseFloat(E[1]),parseFloat(E[2]),parseFloat(E[3])):null!==(E=T.exec(r))?o.push(parseFloat(E[1]),parseFloat(E[2]),parseFloat(E[3])):null!==(E=c.exec(r))?a.push(parseFloat(E[1]),parseFloat(E[2])):null!==(E=l.exec(r))?S(E[1],E[2],E[3],E[4]):null!==(E=f.exec(r))?S(E[2],E[5],E[8],E[11],E[3],E[6],E[9],E[12]):null!==(E=R.exec(r))?S(E[2],E[6],E[10],E[14],E[3],E[7],E[11],E[15],E[4],E[8],E[12],E[16]):null!==(E=A.exec(r))&&S(E[2],E[5],E[8],E[11],void 0,void 0,void 0,void 0,E[3],E[6],E[9],E[12]))}return mt({positions:r,coords:i,normals:n,indices:_})})(e)}return{id:t,source:i,type:r,file:n}})),console.table(It)};var vt,gt={exports:{}},Ct="object"==typeof Reflect?Reflect:null,Ot=Ct&&"function"==typeof Ct.apply?Ct.apply:function(t,e,r){return Function.prototype.apply.call(t,e,r)};vt=Ct&&"function"==typeof Ct.ownKeys?Ct.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var Ut=Number.isNaN||function(t){return t!=t};function Mt(){Mt.init.call(this)}gt.exports=Mt,gt.exports.once=function(t,e){return new Promise((function(r,i){function n(r){t.removeListener(e,s),i(r)}function s(){"function"==typeof t.removeListener&&t.removeListener("error",n),r([].slice.call(arguments))}Gt(t,e,s,{once:!0}),"error"!==e&&function(t,e,r){"function"==typeof t.on&&Gt(t,"error",e,r)}(t,n,{once:!0})}))},Mt.EventEmitter=Mt,Mt.prototype._events=void 0,Mt.prototype._eventsCount=0,Mt.prototype._maxListeners=void 0;var Ft=10;function Pt(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function bt(t){return void 0===t._maxListeners?Mt.defaultMaxListeners:t._maxListeners}function Bt(t,e,r,i){var n,s,o,a;if(Pt(r),void 0===(s=t._events)?(s=t._events=Object.create(null),t._eventsCount=0):(void 0!==s.newListener&&(t.emit("newListener",e,r.listener?r.listener:r),s=t._events),o=s[e]),void 0===o)o=s[e]=r,++t._eventsCount;else if("function"==typeof o?o=s[e]=i?[r,o]:[o,r]:i?o.unshift(r):o.push(r),(n=bt(t))>0&&o.length>n&&!o.warned){o.warned=!0;var _=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");_.name="MaxListenersExceededWarning",_.emitter=t,_.type=e,_.count=o.length,a=_,console&&console.warn&&console.warn(a)}return t}function Dt(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function xt(t,e,r){var i={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},n=Dt.bind(i);return n.listener=r,i.wrapFn=n,n}function yt(t,e,r){var i=t._events;if(void 0===i)return[];var n=i[e];return void 0===n?[]:"function"==typeof n?r?[n.listener||n]:[n]:r?function(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}(n):Xt(n,n.length)}function wt(t){var e=this._events;if(void 0!==e){var r=e[t];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function Xt(t,e){for(var r=new Array(e),i=0;i<e;++i)r[i]=t[i];return r}function Gt(t,e,r,i){if("function"==typeof t.on)i.once?t.once(e,r):t.on(e,r);else{if("function"!=typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(e,(function n(s){i.once&&t.removeEventListener(e,n),r(s)}))}}Object.defineProperty(Mt,"defaultMaxListeners",{enumerable:!0,get:function(){return Ft},set:function(t){if("number"!=typeof t||t<0||Ut(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");Ft=t}}),Mt.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Mt.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||Ut(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},Mt.prototype.getMaxListeners=function(){return bt(this)},Mt.prototype.emit=function(t){for(var e=[],r=1;r<arguments.length;r++)e.push(arguments[r]);var i="error"===t,n=this._events;if(void 0!==n)i=i&&void 0===n.error;else if(!i)return!1;if(i){var s;if(e.length>0&&(s=e[0]),s instanceof Error)throw s;var o=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw o.context=s,o}var a=n[t];if(void 0===a)return!1;if("function"==typeof a)Ot(a,this,e);else{var _=a.length,E=Xt(a,_);for(r=0;r<_;++r)Ot(E[r],this,e)}return!0},Mt.prototype.addListener=function(t,e){return Bt(this,t,e,!1)},Mt.prototype.on=Mt.prototype.addListener,Mt.prototype.prependListener=function(t,e){return Bt(this,t,e,!0)},Mt.prototype.once=function(t,e){return Pt(e),this.on(t,xt(this,t,e)),this},Mt.prototype.prependOnceListener=function(t,e){return Pt(e),this.prependListener(t,xt(this,t,e)),this},Mt.prototype.removeListener=function(t,e){var r,i,n,s,o;if(Pt(e),void 0===(i=this._events))return this;if(void 0===(r=i[t]))return this;if(r===e||r.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete i[t],i.removeListener&&this.emit("removeListener",t,r.listener||e));else if("function"!=typeof r){for(n=-1,s=r.length-1;s>=0;s--)if(r[s]===e||r[s].listener===e){o=r[s].listener,n=s;break}if(n<0)return this;0===n?r.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(r,n),1===r.length&&(i[t]=r[0]),void 0!==i.removeListener&&this.emit("removeListener",t,o||e)}return this},Mt.prototype.off=Mt.prototype.removeListener,Mt.prototype.removeAllListeners=function(t){var e,r,i;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[t]),this;if(0===arguments.length){var n,s=Object.keys(r);for(i=0;i<s.length;++i)"removeListener"!==(n=s[i])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=r[t]))this.removeListener(t,e);else if(void 0!==e)for(i=e.length-1;i>=0;i--)this.removeListener(t,e[i]);return this},Mt.prototype.listeners=function(t){return yt(this,t,!0)},Mt.prototype.rawListeners=function(t){return yt(this,t,!1)},Mt.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):wt.call(t,e)},Mt.prototype.listenerCount=wt,Mt.prototype.eventNames=function(){return this._eventsCount>0?vt(this._events):[]};var Vt=gt.exports.EventEmitter;function Ht(){Vt.call(this),this.setMaxListeners(20)}Ht.prototype=Object.create(Vt.prototype),Ht.prototype.constructor=Ht,Ht.prototype.off=function(t,e){return e?this.removeListener(t,e):t?this.removeAllListeners(t):this.removeAllListeners()};var Wt=Ht,jt=function(){try{return!!new Blob}catch(t){return!1}}(),Yt={mbs:0,secs:0,update:function(t,e,r,i){var n,s=t.getAllResponseHeaders();if(s){var o=s.match(/content-length: (\d+)/i);o&&o.length&&(n=o[1])}if(n){var a=(n=parseInt(n,10))/1024/1024,_=(Date.now()-e)/1e3;this.secs+=_,this.mbs+=a,i&&this.log(r,a,_)}else i&&console.warn.call(console,"Can't get Content-Length:",r)},log:function(t,e,r){if(t){var i="File loaded: "+t.substr(t.lastIndexOf("/")+1)+" size:"+e.toFixed(2)+"mb time:"+r.toFixed(2)+"s speed:"+(e/r).toFixed(2)+"mbps";console.log.call(console,i)}var n="Total loaded: "+this.mbs.toFixed(2)+"mb time:"+this.secs.toFixed(2)+"s speed:"+this.getMbps().toFixed(2)+"mbps";console.log.call(console,n)},getMbps:function(){return this.mbs/this.secs}},kt=Wt,Kt=jt,Zt=Yt,zt=Wt,Qt=function(t){var e,r,i,n,s,o,a=t.id,_=t.basePath||"",E=t.url,h=t.type,u=t.crossOrigin,T=t.isTouchLocked,c=t.blob&&Kt,l=t.webAudioContext,f=t.log,R=function(t){t&&(o={id:a,file:t,type:h},e.emit("progress",1),e.emit("complete",o,a,h),P())},A=function(t,e){r=e||p,(i=new XMLHttpRequest).open("GET",_+E,!0),i.responseType=t,i.addEventListener("progress",d),i.addEventListener("load",r),i.addEventListener("error",F),i.send()},d=function(t){t.lengthComputable&&e.emit("progress",t.loaded/t.total)},p=function(){L()&&R(i.response)},L=function(){return i&&i.status<400?(Zt.update(i,n,E,f),!0):(F(i&&i.statusText),!1)},m=function(){A("json",(function(){if(L()){var t=i.response;"string"==typeof t&&(t=JSON.parse(t)),R(t)}}))},N=function(){c?v():I()},I=function(){i=new Image,u&&(i.crossOrigin="anonymous"),i.addEventListener("error",F,!1),i.addEventListener("load",S,!1),i.src=_+E},S=function(t){window.clearTimeout(s),t||!i.error&&i.readyState?R(i):F()},v=function(){A("blob",(function(){L()&&((i=new Image).addEventListener("error",F,!1),i.addEventListener("load",g,!1),i.src=window.URL.createObjectURL(i.response))}))},g=function(){window.URL.revokeObjectURL(i.src),R(i)},C=function(){l?U():M("audio")},O=function(){c?A("blob"):M("video")},U=function(){A("arraybuffer",(function(){L()&&l.decodeAudioData(i.response,(function(t){i=null,R(t)}),(function(t){F(t)}))}))},M=function(t){i=document.createElement(t),T||(window.clearTimeout(s),s=window.setTimeout(S,2e3),i.addEventListener("canplaythrough",S,!1)),i.addEventListener("error",F,!1),i.preload="auto",i.src=_+E,i.load(),T&&R(i)},F=function(t){window.clearTimeout(s);var r=t;if(i&&i.tagName&&i.error){r="MediaError: "+["","ABORTED","NETWORK","DECODE","SRC_NOT_SUPPORTED"][i.error.code]+" "+i.src}else i&&i.statusText?r=i.statusText:t&&t.message?r=t.message:t&&t.type&&(r=t.type);e.emit("error",'Error loading "'+_+E+'" '+r),b()},P=function(){e.off("error"),e.off("progress"),e.off("complete"),i&&(i.removeEventListener("progress",d),i.removeEventListener("load",r),i.removeEventListener("error",F),i.removeEventListener("load",S),i.removeEventListener("canplaythrough",S),i.removeEventListener("load",g))},b=function(){P(),i&&i.abort&&i.readyState<4&&i.abort(),i=null,l=null,o=null,window.clearTimeout(s),e.emit("destroy",a)};return e=Object.create(kt.prototype,{_events:{value:{}},id:{value:t.id},start:{value:function(){switch(n=Date.now(),h){case"json":m();break;case"jpg":case"png":case"gif":case"webp":case"svg":N();break;case"mp3":case"ogg":case"opus":case"wav":case"m4a":C();break;case"ogv":case"mp4":case"webm":case"hls":O();break;case"bin":case"binary":A("arraybuffer");break;case"txt":case"text":A("text");break;default:throw"AssetsLoader ERROR: Unknown type for file with URL: "+_+E+" ("+h+")"}}},loaded:{get:function(){return!!o}},file:{get:function(){return o}},destroy:{value:b}})},qt=0,$t=function t(e){var r,i={},n=[],s=[],o=0,a=0,_={},E=function(i){return Array.isArray(i)?(i.forEach(E),r):((n=!!i.assets&&Array.isArray(i.assets)?t(u(i,e)):Qt(u(i,e))).once("destroy",f),s.push(n),_[n.id]=n,r);var n},h=function(t){return arguments.length?i[t]?i[t]:_[t]:n},u=function(t,e){"string"==typeof t&&(t={url:t});return void 0===t.isTouchLocked&&(t.isTouchLocked=e.isTouchLocked),void 0===t.blob&&(t.blob=e.blob),void 0===t.basePath&&(t.basePath=e.basePath),t.id=t.id||t.url||String(++qt),t.type=t.type||function(t){return t&&t.split("?")[0].split(".").pop().toLowerCase()}(t.url),t.crossOrigin=t.crossOrigin||e.crossOrigin,t.webAudioContext=t.webAudioContext||e.webAudioContext,t.log=e.log,t},T=function(t){var e=o+t;r.emit("progress",e/a)},c=function(t,e,s){Array.isArray(t)&&(t={id:e,file:t,type:s}),o++,r.emit("progress",o/a),i[t.id]=t.file,n.push(t),r.emit("childcomplete",t),R()},l=function(t){a--,r.listeners("error").length?r.emit("error",t):console.error(t),R()},f=function(t){_[t]=null,delete _[t],i[t]=null,delete i[t],n.some((function(e,r){if(e.id===t)return n.splice(r,1),!0}))},R=function(){o>=a&&r.emit("complete",n,i,e.id,"group")};return r=Object.create(zt.prototype,{_events:{value:{}},id:{get:function(){return e.id}},add:{value:E},start:{value:function(){return a=s.length,s.forEach((function(t){t.on("progress",T).once("complete",c).once("error",l).start()})),s=[],r}},get:{value:h},find:{value:function(t){if(h(t))return h(t);var e=null;return Object.keys(_).some((function(r){return!!(e=_[r].find&&_[r].find(t))})),e}},getLoader:{value:function(t){return _[t]}},loaded:{get:function(){return o>=a}},file:{get:function(){return n}},destroy:{value:function(){for(;s.length;)s.pop().destroy();return r.off("error"),r.off("progress"),r.off("complete"),n=[],i={},e.webAudioContext=null,a=0,o=0,Object.keys(_).forEach((function(t){_[t].destroy()})),_={},r.emit("destroy",r.id),r}}}),e=u(e||{},{basePath:"",blob:!1,touchLocked:!1,crossOrigin:null,webAudioContext:null,log:!1}),Array.isArray(e.assets)&&E(e.assets),r};$t.stats=Yt;var Jt=$t;const te=t=>{console.error(t)},ee=Math.PI/180;return class extends e{constructor(){var t;super(),this.canvas=document.createElement("canvas"),w.init(this.canvas,{alpha:!0,preserveDrawingBuffer:!0}),this._isPlaying=!1,this._efIndex=Rt((()=>this._loop())),new Promise(((e,r)=>{const i=document.body.querySelector(".Loading-Bar");console.log("Load Assets",Nt),Nt.length>0?(document.body.classList.add("isLoading"),new Jt({assets:Nt}).on("error",(t=>{console.log("Error :",t)})).on("progress",(t=>{i&&(i.style.width=100*t+"%")})).on("complete",(r=>{i&&(i.style.width="100%"),St(r),setTimeout((()=>{document.body.classList.remove("isLoading"),e(t)}),500)})).start()):e(t)})).then((()=>this._onAssetsLoaded()),te)}_onAssetsLoaded(){console.log("Assets loaded"),this._initWorld(),this.emit("loaded")}_initWorld(){this._camera=new q,this._camera.setPerspective(70*ee,w.aspectRatio,.1,50),this._orbitalControl=new Lt(this._camera,window,5),this._orbitalControl.rx.value=this._orbitalControl.ry.value=.3,this._dAxis=new J,this._dDots=new tt,this._isPlaying=!0}play(){this._isPlaying=!0}pause(){this._isPlaying=!1}_loop(){this._isPlaying&&(this._update(),this._render())}_update(){}_render(){w.viewport(0,0,w.width,w.height),w.clear(0,0,0,1),w.setMatrices(this._camera),this._dAxis.draw(),this._dDots.draw()}resize(t,e){w.setSize(t,e),this._camera&&this._camera.setPerspective(70*ee,w.aspectRatio,.1,50)}destroy(){At(this._efIndex)}}}));
